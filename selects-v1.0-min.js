/* 
 *
 * selects.js v1.0 (c) 2014
 * Cross-Browser <select> Styling 
 * 
 * @author  : Zach Winter (contact@zachwinter.com)
 * @license : MIT (http://www.opensource.org/licenses/mit-license.php)
 *
 */

;(function(a){a.fn.selects=function(g){var k=this,f=[],o=false,p=false,d={9:false,13:false,16:false,38:false,40:false},j={overrideMobileBehavior:false,useCssTransitions:true,slideSpeed:300,dropdownHeight:150,proxy:{select:a('[data-form-element="select"]'),dropdown:a('[data-form-element="select-dropdown"]'),button:a('[data-form-element="select-button"]'),honeyPot:a(".hp")}},e=a.extend(j,g);if(e.useCssTransitions===true){if(typeof(Modernizr)!="undefined"&&typeof(Modernizr.csstransitions)!="undefined"){o=Modernizr.csstransitions}else{var n=document.createElement("div").style,m=[n.transition,n.WebkitTransition,n.MozTransition];for(var h=0;h<m.length;h++){if(m[h]!==undefined){o=true}}}}if(e.overrideMobileBehavior===false){var c=function(){return(function(q,i){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(q)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(q.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera)};p=c()}if(!Object.create){Object.create=(function(){function b(){}return function(i){if(arguments.length!=1){throw new Error("Object.create implementation only accepts one parameter.")}b.prototype=i;return new b()}})()}var l={form:null,proxy:null,select:null,options:null,dropdown:null,button:null,selected:null,namespace:null,createElement:function(){var b=this;b.proxy.append('<ul data-form-element="select-dropdown" />');b.proxy.prepend('<a data-form-element="select-button" />');b.form=b.proxy.find("select").attr("data-form"),b.select=b.proxy.find("select"),b.options=b.proxy.find("option"),b.dropdown=b.proxy.find(e.proxy.dropdown.selector),b.button=b.proxy.find(e.proxy.button.selector),b.selected=b.proxy.find(":selected");b.namespace=".form"+b.form+"element"+a('[data-marker="form-element"]').index(b.select);b.proxy.css("position","relative");b.select.css({display:"block",position:"absolute","z-index":"-1",top:"0px",right:"0px",bottom:"0px",left:"0px",width:"100%",height:"100%","-webkit-appearance":"none","-moz-appearance":"none",appearance:"none",opacity:"0","-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(opacity=0)",filter:"alpha(opaicty = 0)","font-size":"20px"});b.button.css({display:"block",position:"relative","z-index":"1",cursor:"pointer"});b.dropdown.css({position:"absolute",top:"100%",right:"0%",bottom:"auto",left:"0%",margin:"0",padding:"0",height:"0px","list-style-type":"none",overflow:"hidden","-webkit-overflow-style":"auto","-ms-overflow-style":"auto","overflow-style":"auto","-webkit-overflow-scrolling":"touch","overflow-scrolling":"touch"});b.options.each(function(){var i={select:' data-select="option"',option:' data-option="'+a(this).index()+'"',selected:' data-selected="'+a(this).attr("selected")+'"',disabled:a(this).attr("disabled")?' data-disabled="disabled"':""};b.dropdown.append('<li><a style="display: block; cursor: pointer;" '+i.select+i.option+i.selected+i.disabled+">"+a(this).html()+"</a></li>")});if(b.selected.length){b.button.html(b.selected.html());b.dropdown.find("li:eq("+b.selected.index()+") a").addClass("focus")}else{b.button.html(b.dropdown.find("li:first-child a").html());b.options.eq(0).prop("selected",true).attr("selected","selected");b.dropdown.find("li:first-child a").addClass("focus")}if(e.useCssTransitions===true&&o===true){b.dropdown.css({"-webkit-transition":"height "+e.slideSpeed/1000+"s ease","-moz-transition":"height "+e.slideSpeed/1000+"s ease",transition:"height "+e.slideSpeed/1000+"s ease"})}if(e.overrideMobileBehavior===false&&p===true){b.select.css("z-index","10").on("change"+b.namespace,function(){b.button.html(b.options.filter(":selected").text())})}},toggleDropdown:function(){var b=this;var i=function(){a(document).one("click"+b.namespace,function(){q();b.proxy.removeClass("focus")})};var r=function(){if(!b.dropdown.attr("data-height")){var u=b.dropdown.clone();u.css({position:"fixed",top:"-500%",left:"-500%",display:"block",height:"auto","max-height":"none"});b.proxy.append(u);var t=u.height();u.remove();if(t>e.dropdownHeight){t=e.dropdownHeight;b.dropdown.css("overflow-y","scroll")}b.dropdown.attr("data-height",t);return t}else{return b.dropdown.attr("data-height")}};var s=function(){b.dropdown.addClass("vis");if(e.useCssTransitions===true&&o===true){b.dropdown.css({"z-index":"10",height:r})}else{r();b.dropdown.css({height:"auto",display:"none","z-index":"10","max-height":e.dropdownHeight}).slideDown(e.slideSpeed)}};var q=function(){b.dropdown.removeClass("vis");if(e.useCssTransitions===true&&o===true){b.dropdown.on("transitionend"+b.namespace+" webkitTransitionEnd"+b.namespace,function(){b.dropdown.off("transitionend"+b.namespace+" webkitTransitionEnd"+b.namespace);b.dropdown.css("z-index","auto")}).css("height","0")}else{b.dropdown.slideUp(e.slideSpeed,function(){b.dropdown.css("z-index","auto")})}};if(b.dropdown.hasClass("vis")){q()}else{s();setTimeout(i,e.slideSpeed)}},selectOption:function(b){var i=this;if(b.attr("data-selected")=="undefined"){i.dropdown.find(".focus").removeClass("focus");b.addClass("focus");i.dropdown.find('[data-selected="selected"]').attr("data-selected","undefined");b.attr("data-selected","selected");i.button.html(b.html());i.options.prop("selected",false).removeAttr("selected");i.options.eq(b.attr("data-option")).prop("selected",true).attr("selected","selected");i.select.trigger("change"+i.namespace)}},bind:function(){var b=this;b.button.on("click"+b.namespace,function(i){if(e.overrideMobileBehavior===false&&p===true){i.preventDefault()}else{if(p===false){b.keyBind(b.proxy)}b.toggleDropdown();b.proxy.addClass("focus")}});b.dropdown.find("a").on("click"+b.namespace,function(){a(document).off("keydown"+b.namespace);b.selectOption(a(this))})},KV:{focused:null,index:null,scroll:null},updateFocusedOption:function(i){var b=this;b.KV.focused=b.dropdown.find(".focus");b.KV.index=parseInt(b.KV.focused.attr("data-option"));b.KV.index=(i=="next")?b.KV.index+1:b.KV.index-1;b.KV.focused.removeClass("focus");b.KV.focused=b.dropdown.find('[data-option="'+b.KV.index+'"]').addClass("focus");if(!b.dropdown.hasClass("vis")){b.selectOption(b.dropdown.find('[data-option="'+b.KV.index+'"]'));b.updateScrollTop(true)}else{b.updateScrollTop()}},updateScrollTop:function(i){var b=this;if(i===true){b.KV.scroll=b.KV.focused.position().top+b.dropdown.scrollTop()}else{if(b.KV.focused.position().top+b.KV.focused.outerHeight()>b.dropdown.height()){b.KV.scroll=b.dropdown.scrollTop()+b.KV.focused.position().top}else{if(b.KV.focused.position().top+b.KV.focused.outerHeight()<b.KV.focused.outerHeight()){b.KV.scroll=b.dropdown.scrollTop()-b.dropdown.height()+(b.KV.focused.position().top+b.KV.focused.outerHeight())}}}b.dropdown.scrollTop(b.KV.scroll)},keyBind:function(){var b=this;a(document).on("keydown"+b.namespace,function(i){if(d[9]===true&&d[16]===false){if(b.dropdown.hasClass("vis")){b.toggleDropdown()}b.focusNewElement();a(document).off("keydown"+b.namespace);i.preventDefault()}if(d[9]===true&&d[16]===true){if(b.dropdown.hasClass("vis")){b.toggleDropdown()}b.focusNewElement();a(document).off("keydown"+b.namespace);i.preventDefault()}if(d[13]){if(b.dropdown.hasClass("vis")){b.selectOption(b.dropdown.find(".focus"));b.focusNewElement();a(document).off("keydown"+b.namespace)}b.toggleDropdown();i.preventDefault()}if(d[38]){i.preventDefault();if(!b.dropdown.find("li:first-child a").hasClass("focus")){b.updateFocusedOption("prev")}}if(d[40]){i.preventDefault();if(!b.dropdown.find("li:last-child a").hasClass("focus")){b.updateFocusedOption("next")}}})},focusRouting:function(){var b=this;if(p===false||p===true&&e.overrideMobileBehavior===true){b.select.on("focus"+b.namespace,function(i){i.preventDefault();b.select.trigger("blur"+b.namespace);b.proxy.addClass("focus");if(d[9]===true||d[13]===true){b.toggleDropdown()}b.keyBind()})}},focusNewElement:function(r){var i=this,r=null;d[9]===true&&d[16]===true?r=-1:r=1;var q=f[i.form].indexing.index(i.select)+r,b=f[i.form].indexing.eq(q);i.proxy.removeClass("focus");b.trigger("focus"+i.namespace)},init:function(){var b=this;b.createElement();b.bind();b.focusRouting()}};a(document).on("keydown.selects",function(b){if(b.keyCode in d){d[b.keyCode]=true}});a(document).on("keyup.selects",function(b){if(b.keyCode in d){d[b.keyCode]=false}});a(window).on("resize.selects",function(){var b=a(e.proxy.dropdown.selector);if(b.attr("data-height")){b.removeAttr("data-height")}});k.each(function(){var b=k.index(a(this));f[b]={html:a(this),indexing:null,selects:[]};f[b].html.find("input, textarea, select, button").not('[type="hidden"], [disabled], [type="disabled"]').attr({"data-marker":"form-element","data-form":b});if(e.proxy.honeyPot.find("input").length){e.proxy.honeyPot.find("input").removeAttr("data-marker")}f[b].indexing=f[b].html.find('[data-marker="form-element"]');f[b].html.find(e.proxy.select).each(function(){var q=e.proxy.select.index(a(this));f[b].selects[q]=Object.create(l);f[b].selects[q].proxy=a(this);f[b].selects[q].init()})})}}(jQuery));